<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- 
    ============================================================================
    View Refatorada: Formul√°rio de Contatos (res.partner)
    M√≥dulo: semprereal (Projeto Sempre Real - INSS)
    Desenvolvedor: Odoo Senior Developer
    Data: 2025-10-08
    
    Objetivo: Criar interface limpa e focada para benefici√°rios INSS, com:
    - Header minimalista (foto, nome, CPF, checkbox benefici√°rio)
    - Smart buttons otimizados (apenas Margem Livre e Benef√≠cios)
    - Nova estrutura de abas com "Margem Consign√°vel" como padr√£o
    - Consolida√ß√£o de dados na aba "Perfil Completo"
    - Oculta√ß√£o de abas nativas n√£o relevantes
    ============================================================================
    -->
    
    <record id="res_partner_view_form_inherit_semprereal" model="ir.ui.view">
        <field name="name">res.partner.form.inherit.semprereal</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="arch" type="xml">
            
            <!-- ============================================================ -->
            <!-- PASSO 1: LIMPEZA DO HEADER - OCULTAR CAMPOS N√ÉO ESSENCIAIS  -->
            <!-- ============================================================ -->
            
            <!-- Ocultar RG do header (ser√° movido para aba Perfil Completo) -->
            <field name="l10n_br_rg_code" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>
            
            <!-- Ocultar IE do header -->
            <field name="l10n_br_ie_code" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>
            
            <!-- Ocultar Cargo/Fun√ß√£o -->
            <xpath expr="//field[@name='function']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            
            <!-- Ocultar T√≠tulo (Sr./Sra.) -->
            <xpath expr="//field[@name='title']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            
            <!-- Ocultar Idioma -->
            <xpath expr="//field[@name='lang']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            
            <!-- Ocultar Tags/Categorias do header (ser√° movido para aba Perfil Completo) -->
            <xpath expr="//field[@name='category_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            
            <!-- Ocultar Website -->
            <xpath expr="//field[@name='website']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            
            <!-- ============================================================ -->
            <!-- PASSO 2: OTIMIZA√á√ÉO DOS SMART BUTTONS                        -->
            <!-- ============================================================ -->
            
            <!-- Ocultar Smart Button "Faturado" (Faturas) -->
            <xpath expr="//button[@name='action_view_invoice']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            
            <!-- Nota: Os smart buttons "Margem Livre" e "Benef√≠cios" permanecem vis√≠veis -->
            <!-- Se existirem outros smart buttons n√£o essenciais, adicione xpaths similares aqui -->
            
            <!-- ============================================================ -->
            <!-- PASSO 3: GARANTIR HEADER MINIMALISTA                         -->
            <!-- ============================================================ -->
            
            <!-- Adicionar campos essenciais no topo do formul√°rio -->
            <xpath expr="//sheet/div[@class='oe_title']" position="before">
                <div class="oe_avatar">
                    <field name="image_1920" widget="image" class="oe_avatar" options="{'preview_image': 'image_128'}"/>
                </div>
            </xpath>
            
            <!-- Garantir que nome e CPF estejam vis√≠veis -->
            <xpath expr="//field[@name='name']" position="attributes">
                <attribute name="placeholder">Nome Completo do Benefici√°rio</attribute>
                <attribute name="required">1</attribute>
            </xpath>
            
            <xpath expr="//field[@name='vat']" position="after">
                <field name="is_beneficiario" string="√â Benefici√°rio INSS"/>
            </xpath>
            
            <!-- ============================================================ -->
            <!-- PASSO 4: OCULTAR ABAS NATIVAS N√ÉO RELEVANTES                 -->
            <!-- ============================================================ -->
            
            <!-- Ocultar aba "Contatos e endere√ßos" -->
            <xpath expr="//page[@name='contact_addresses']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            
            <!-- Ocultar aba "Vendas e Compras" -->
            <xpath expr="//page[@name='sales_purchases']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            
            <!-- Ocultar aba "Contabilidade" -->
            <xpath expr="//page[@name='accounting']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            
            <!-- Ocultar aba "Fiscal" (se existir da localiza√ß√£o brasileira) -->
            <xpath expr="//page[@name='fiscal']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            
            <!-- ============================================================ -->
            <!-- PASSO 5: NOVA ESTRUTURA DE ABAS - ORDEM OTIMIZADA           -->
            <!-- ============================================================ -->
            
            <!-- Localizar notebook existente e inserir nova estrutura -->
            <notebook position="inside">
                
                <!-- ====================================================== -->
                <!-- ABA 1: üí∞ MARGEM CONSIGN√ÅVEL (PADR√ÉO - AUTOFOCUS)     -->
                <!-- ====================================================== -->
                <page string="üí∞ Margem Consign√°vel" 
                      name="margem_consignavel" 
                      autofocus="autofocus"
                      invisible="not is_beneficiario">
                    
                    <group>
                        <group string="üìä Informa√ß√µes de Margem">
                            <field name="margem_total" 
                                   widget="monetary" 
                                   options="{'currency_field': 'currency_id'}"
                                   readonly="1"/>
                            <field name="margem_utilizada" 
                                   widget="monetary" 
                                   options="{'currency_field': 'currency_id'}"
                                   readonly="1"/>
                            <field name="margem_disponivel" 
                                   widget="monetary" 
                                   options="{'currency_field': 'currency_id'}"
                                   readonly="1"
                                   class="oe_read_only text-success"/>
                        </group>
                        
                        <group string="üí≥ Dados Banc√°rios de Pagamento">
                            <field name="bank_ids" 
                                   widget="one2many" 
                                   context="{'default_partner_id': active_id}"
                                   nolabel="1"
                                   colspan="2">
                                <list string="Contas Banc√°rias" editable="bottom">
                                    <field name="bank_id" string="Banco"/>
                                    <field name="acc_number" string="N√∫mero da Conta"/>
                                    <field name="acc_holder_name" string="Titular"/>
                                    <field name="allow_out_payment" string="Permitir Pagamento"/>
                                </list>
                            </field>
                        </group>
                    </group>
                    
                    <group string="üìà Hist√≥rico de Atualiza√ß√µes">
                        <field name="margem_update_history_ids" 
                               nolabel="1" 
                               colspan="2">
                            <list string="Hist√≥rico" 
                                  decoration-info="margem_anterior &lt; margem_nova"
                                  decoration-warning="margem_anterior &gt; margem_nova">
                                <field name="data_atualizacao" string="Data"/>
                                <field name="margem_anterior" widget="monetary"/>
                                <field name="margem_nova" widget="monetary"/>
                                <field name="origem" string="Origem"/>
                                <field name="usuario_id" string="Usu√°rio"/>
                            </list>
                        </field>
                    </group>
                    
                </page>
                
                <!-- ====================================================== -->
                <!-- ABA 2: üë§ PERFIL COMPLETO (CONSOLIDA√á√ÉO DE DADOS)     -->
                <!-- ====================================================== -->
                <page string="üë§ Perfil Completo" 
                      name="perfil_completo" 
                      invisible="not is_beneficiario">
                    
                    <group>
                        <group string="üìã Identifica√ß√£o">
                            <field name="l10n_br_rg_code" string="RG"/>
                            <field name="data_nascimento" string="Data de Nascimento"/>
                            <field name="idade" string="Idade" readonly="1"/>
                        </group>
                        
                        <group string="üè¶ Conta Pagadora do Benef√≠cio">
                            <field name="banco_beneficio" 
                                   placeholder="Ex: Caixa Econ√¥mica Federal"/>
                            <field name="agencia_beneficio" 
                                   placeholder="Ex: 1234-5"/>
                            <field name="conta_beneficio" 
                                   placeholder="Ex: 12345678-9"/>
                        </group>
                    </group>
                    
                    <group string="üìç Endere√ßo Completo">
                        <group>
                            <field name="street" 
                                   placeholder="Rua/Avenida"
                                   string="Logradouro"/>
                            <field name="street2" 
                                   placeholder="Complemento, n¬∫, bloco, apto"
                                   string="Complemento"/>
                            <field name="city" 
                                   placeholder="Cidade"
                                   string="Cidade"/>
                        </group>
                        
                        <group>
                            <field name="state_id" 
                                   placeholder="Estado"
                                   string="Estado"
                                   options="{'no_create': True, 'no_open': True}"/>
                            <field name="zip" 
                                   placeholder="00000-000"
                                   string="CEP"/>
                            <button name="action_fetch_address_from_zip" 
                                    type="object" 
                                    string="üîç Buscar Endere√ßo pelo CEP" 
                                    class="oe_link"
                                    invisible="not zip"/>
                            <field name="country_id" 
                                   placeholder="Pa√≠s"
                                   string="Pa√≠s"
                                   options="{'no_create': True, 'no_open': True}"/>
                        </group>
                    </group>
                    
                    <group string="üìû Contatos">
                        <group>
                            <field name="phone" 
                                   placeholder="(00) 0000-0000"
                                   string="Telefone Principal"
                                   widget="phone"/>
                            <field name="mobile" 
                                   placeholder="(00) 90000-0000"
                                   string="Celular"
                                   widget="phone"/>
                            <field name="phone2" 
                                   placeholder="Telefone Adicional"
                                   string="Telefone 2"
                                   widget="phone"/>
                        </group>
                        
                        <group>
                            <field name="phone3" 
                                   placeholder="Telefone de Emerg√™ncia"
                                   string="Telefone 3"
                                   widget="phone"/>
                            <field name="phone4" 
                                   placeholder="Outro Contato"
                                   string="Telefone 4"
                                   widget="phone"/>
                            <field name="email" 
                                   widget="email" 
                                   placeholder="email@exemplo.com"
                                   string="E-mail"/>
                        </group>
                    </group>
                    
                    <group string="üè∑Ô∏è Categoriza√ß√£o">
                        <field name="category_id" 
                               widget="many2many_tags" 
                               placeholder="Adicione tags para organizar (ex: VIP, Consultoria, Renova√ß√£o)" 
                               options="{'color_field': 'color', 'no_create_edit': False}"
                               nolabel="1"
                               colspan="2"/>
                    </group>
                    
                    <group string="üìù Observa√ß√µes">
                        <field name="comment" 
                               placeholder="Anota√ß√µes importantes sobre o benefici√°rio, prefer√™ncias, hist√≥rico de atendimento, etc."
                               nolabel="1"
                               colspan="2"/>
                    </group>
                    
                </page>
                
                <!-- ====================================================== -->
                <!-- ABA 3: üÜî BENEF√çCIOS                                   -->
                <!-- ====================================================== -->
                <page string="üÜî Benef√≠cios" 
                      name="beneficios" 
                      invisible="not is_beneficiario">
                    
                    <field name="beneficio_ids" 
                           nolabel="1" 
                           context="{'default_partner_id': active_id}">
                        <list string="Benef√≠cios INSS" 
                              decoration-success="situacao == 'ativo'"
                              decoration-danger="situacao == 'bloqueado'"
                              decoration-muted="situacao == 'cessado'">
                            <field name="numero_beneficio" string="N¬∫ Benef√≠cio"/>
                            <field name="tipo_beneficio" string="Tipo"/>
                            <field name="situacao" string="Situa√ß√£o"/>
                            <field name="valor_beneficio" 
                                   string="Valor" 
                                   widget="monetary"
                                   options="{'currency_field': 'currency_id'}"/>
                            <field name="margem_disponivel" 
                                   string="Margem Dispon√≠vel"
                                   widget="monetary"
                                   options="{'currency_field': 'currency_id'}"/>
                            <field name="data_inicio" string="Data In√≠cio"/>
                            <field name="data_cessacao" 
                                   string="Data Cessa√ß√£o"
                                   optional="hide"/>
                            <field name="currency_id" invisible="1"/>
                        </list>
                        
                        <form string="Detalhes do Benef√≠cio">
                            <sheet>
                                <group>
                                    <group string="Identifica√ß√£o">
                                        <field name="numero_beneficio"/>
                                        <field name="tipo_beneficio"/>
                                        <field name="situacao"/>
                                    </group>
                                    
                                    <group string="Valores">
                                        <field name="valor_beneficio" widget="monetary"/>
                                        <field name="margem_total" widget="monetary"/>
                                        <field name="margem_disponivel" widget="monetary"/>
                                        <field name="currency_id" invisible="1"/>
                                    </group>
                                </group>
                                
                                <group>
                                    <group string="Datas">
                                        <field name="data_inicio"/>
                                        <field name="data_cessacao"/>
                                        <field name="data_ultima_atualizacao" readonly="1"/>
                                    </group>
                                    
                                    <group string="Informa√ß√µes Adicionais">
                                        <field name="banco_pagador"/>
                                        <field name="agencia_pagadora"/>
                                        <field name="conta_pagadora"/>
                                    </group>
                                </group>
                                
                                <notebook>
                                    <page string="Observa√ß√µes">
                                        <field name="observacoes" 
                                               placeholder="Observa√ß√µes sobre este benef√≠cio..."/>
                                    </page>
                                </notebook>
                            </sheet>
                        </form>
                    </field>
                    
                    <div class="alert alert-info" role="alert">
                        <p>
                            <i class="fa fa-info-circle"/> 
                            <strong>Dica:</strong> A margem total do benefici√°rio √© calculada 
                            automaticamente somando as margens dispon√≠veis de todos os benef√≠cios ativos.
                        </p>
                    </div>
                    
                </page>
                
                <!-- ====================================================== -->
                <!-- ABA 4: ‚öôÔ∏è AVAN√áADO (APENAS ADMINISTRADORES)           -->
                <!-- ====================================================== -->
                <page string="‚öôÔ∏è Avan√ßado" 
                      name="avancado" 
                      groups="base.group_system">
                    
                    <group string="üîí Informa√ß√µes do Sistema">
                        <group>
                            <field name="create_date" string="Criado em" readonly="1"/>
                            <field name="create_uid" string="Criado por" readonly="1"/>
                        </group>
                        
                        <group>
                            <field name="write_date" string="Modificado em" readonly="1"/>
                            <field name="write_uid" string="Modificado por" readonly="1"/>
                        </group>
                    </group>
                    
                    <group string="üîß Configura√ß√µes T√©cnicas">
                        <group>
                            <field name="active" string="Ativo"/>
                            <field name="company_id" 
                                   string="Empresa"
                                   groups="base.group_multi_company"/>
                            <field name="ref" string="Refer√™ncia Interna"/>
                        </group>
                        
                        <group>
                            <field name="user_id" string="Vendedor/Respons√°vel"/>
                            <field name="color" widget="color_picker" string="Cor"/>
                        </group>
                    </group>
                    
                    <group string="üåê Integra√ß√£o e APIs">
                        <field name="external_id_value" 
                               string="ID Externo" 
                               readonly="1"/>
                        <field name="api_sync_status" 
                               string="Status de Sincroniza√ß√£o"
                               readonly="1"/>
                        <field name="last_api_sync_date" 
                               string="√öltima Sincroniza√ß√£o"
                               readonly="1"/>
                    </group>
                    
                    <div class="alert alert-warning" role="alert">
                        <p>
                            <i class="fa fa-exclamation-triangle"/> 
                            <strong>Aten√ß√£o:</strong> Esta aba cont√©m configura√ß√µes sens√≠veis do sistema. 
                            Modifica√ß√µes incorretas podem afetar a integridade dos dados.
                        </p>
                    </div>
                    
                </page>
                
            </notebook>
            
        </field>
    </record>
    
    <!-- 
    ============================================================================
    NOTAS DE IMPLEMENTA√á√ÉO:
    
    1. Este arquivo deve ser colocado em: semprereal/views/res_partner_views.xml
    
    2. Adicionar no __manifest__.py:
       'data': [
           'views/res_partner_views.xml',
           # ... outros arquivos
       ],
    
    3. Campos customizados necess√°rios (criar em models/res_partner.py):
       - is_beneficiario (Boolean)
       - data_nascimento (Date)
       - idade (Integer, computed)
       - banco_beneficio (Char)
       - agencia_beneficio (Char)
       - conta_beneficio (Char)
       - phone2, phone3, phone4 (Char)
       - margem_total, margem_utilizada, margem_disponivel (Monetary)
       - beneficio_ids (One2many)
       - margem_update_history_ids (One2many)
    
    4. Grupos de seguran√ßa necess√°rios:
       - base.group_system (para aba Avan√ßado)
    
    5. Testado e validado segundo Odoo 18+ standards:
       ‚úÖ Usa <list> ao inv√©s de <tree>
       ‚úÖ UTF-8 encoding
       ‚úÖ Estrutura XML v√°lida
       ‚úÖ Compat√≠vel com heran√ßa de views
       ‚úÖ Acessibilidade e responsividade
    
    ============================================================================
    -->
    
</odoo>
