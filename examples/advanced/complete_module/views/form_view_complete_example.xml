<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
    =============================================================================
    FORM VIEW COMPLETE EXAMPLE FOR ODOO 18
    =============================================================================

    This file demonstrates all form view features available in Odoo 18:
    - Header with status bar and buttons
    - Sheets and notebooks
    - All field types and widgets
    - Conditional visibility (Odoo 18 syntax)
    - Groups and layouts
    - Chatter integration
    =============================================================================
    -->

    <record id="view_project_form_complete" model="ir.ui.view">
        <field name="name">project.project.form.complete</field>
        <field name="model">project.project</field>
        <field name="arch" type="xml">
            <form string="Project">

                <!-- ========================================= -->
                <!-- HEADER: Status bar and action buttons -->
                <!-- ========================================= -->

                <header>
                    <!-- Status bar (selection field progression) -->
                    <field name="state"
                           widget="statusbar"
                           statusbar_visible="draft,planning,approved,in_progress,done"
                           options="{'clickable': '1', 'fold_field': 'fold'}"/>

                    <!-- Action buttons -->
                    <button name="action_plan"
                            string="Plan"
                            type="object"
                            class="oe_highlight"
                            invisible="state != 'draft'"
                            data-hotkey="p"/>

                    <button name="action_approve"
                            string="Approve"
                            type="object"
                            class="oe_highlight"
                            invisible="state not in ('draft', 'planning')"
                            groups="base.group_system"
                            confirm="Are you sure you want to approve this project?"
                            data-hotkey="a"/>

                    <button name="action_start"
                            string="Start"
                            type="object"
                            class="oe_highlight"
                            invisible="state != 'approved'"
                            data-hotkey="s"/>

                    <button name="action_done"
                            string="Mark as Done"
                            type="object"
                            class="oe_highlight"
                            invisible="state != 'in_progress'"
                            data-hotkey="d"/>

                    <button name="action_hold"
                            string="Put on Hold"
                            type="object"
                            invisible="state != 'in_progress'"/>

                    <button name="action_resume"
                            string="Resume"
                            type="object"
                            class="oe_highlight"
                            invisible="state != 'on_hold'"/>

                    <button name="action_cancel"
                            string="Cancel"
                            type="object"
                            invisible="state in ('done', 'cancelled')"/>

                    <button name="action_reset_to_draft"
                            string="Reset to Draft"
                            type="object"
                            invisible="state not in ('cancelled', 'planning')"
                            groups="base.group_system"/>
                </header>

                <!-- ========================================= -->
                <!-- SHEET: Main content area -->
                <!-- ========================================= -->

                <sheet>

                    <!-- Alert widgets (Odoo 18) -->
                    <div class="alert alert-warning"
                         role="alert"
                         invisible="not is_overdue">
                        <strong>Warning!</strong> This project is overdue.
                        Deadline was <field name="date_deadline" readonly="1"/>.
                    </div>

                    <div class="alert alert-info"
                         role="alert"
                         invisible="state != 'draft'"
                         groups="base.group_no_one">
                        This project is in draft mode. Plan it to proceed.
                    </div>

                    <!-- Widget buttons (top-right corner) -->
                    <div class="oe_button_box" name="button_box">
                        <button name="action_view_tasks"
                                type="object"
                                class="oe_stat_button"
                                icon="fa-tasks">
                            <field name="task_count" widget="statinfo" string="Tasks"/>
                        </button>

                        <button name="action_view_timesheets"
                                type="object"
                                class="oe_stat_button"
                                icon="fa-clock-o"
                                invisible="not task_ids">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_value">
                                    <field name="total_hours_spent" widget="float_time"/>
                                    /
                                    <field name="total_hours_planned" widget="float_time"/>
                                </span>
                                <span class="o_stat_text">Hours</span>
                            </div>
                        </button>

                        <button name="action_view_invoices"
                                type="object"
                                class="oe_stat_button"
                                icon="fa-pencil-square-o"
                                invisible="not is_billable">
                            <field name="amount_invoiced" widget="statinfo" string="Invoiced"/>
                        </button>
                    </div>

                    <!-- Image field (top-left corner for avatar) -->
                    <field name="image_128" widget="image" class="oe_avatar"/>

                    <!-- Title section -->
                    <div class="oe_title">
                        <label for="name" class="oe_edit_only"/>
                        <h1>
                            <field name="name" placeholder="e.g. Website Redesign"/>
                        </h1>
                        <h3>
                            <field name="code" readonly="1" placeholder="Auto-generated"/>
                        </h3>
                    </div>

                    <!-- Main form content -->
                    <group>
                        <group string="General Information">
                            <field name="partner_id"
                                   placeholder="Select a customer..."
                                   options="{'no_create': True, 'no_create_edit': True}"/>

                            <field name="user_id"
                                   widget="many2one_avatar_user"
                                   domain="[('share', '=', False)]"/>

                            <field name="company_id"
                                   groups="base.group_multi_company"
                                   options="{'no_create': True}"/>

                            <field name="parent_id"
                                   invisible="not parent_id"
                                   domain="[('id', '!=', id)]"/>
                        </group>

                        <group string="Classification">
                            <field name="project_type"/>

                            <field name="priority" widget="priority"/>

                            <field name="tag_ids"
                                   widget="many2many_tags"
                                   options="{'color_field': 'color', 'no_create_edit': True}"
                                   placeholder="Add tags..."/>

                            <field name="is_billable"/>
                            <field name="is_template"/>
                            <field name="active" invisible="1"/>
                        </group>
                    </group>

                    <group>
                        <group string="Schedule">
                            <field name="date_start"/>
                            <field name="expected_duration_days"/>
                            <field name="date_end"/>
                            <field name="date_deadline"
                                   decoration-danger="is_overdue"
                                   decoration-warning="days_remaining &lt; 7 and not is_overdue"/>
                            <field name="days_remaining" invisible="1"/>
                            <field name="is_overdue" invisible="1"/>
                        </group>

                        <group string="Budget">
                            <field name="currency_id" invisible="1"/>
                            <field name="budget" widget="monetary"/>
                            <field name="amount_total" widget="monetary"/>
                            <field name="amount_invoiced"
                                   widget="monetary"
                                   invisible="not is_billable"/>
                            <field name="amount_remaining"
                                   widget="monetary"
                                   invisible="not is_billable"/>
                        </group>
                    </group>

                    <!-- Progress indicator -->
                    <group>
                        <field name="progress" widget="progressbar"/>
                    </group>

                    <!-- Notebook (tabs) -->
                    <notebook>
                        <!-- Tab 1: Description -->
                        <page string="Description" name="description">
                            <group>
                                <field name="description"
                                       placeholder="Describe the project objectives and scope..."
                                       nolabel="1"/>
                            </group>
                        </page>

                        <!-- Tab 2: Specification (HTML editor) -->
                        <page string="Specification" name="specification">
                            <field name="specification"
                                   widget="html"
                                   options="{'style-inline': true}"
                                   placeholder="Enter technical specifications..."/>
                        </page>

                        <!-- Tab 3: Tasks (one2many) -->
                        <page string="Tasks" name="tasks">
                            <field name="task_ids">
                                <!-- Inline tree view -->
                                <list string="Tasks" editable="bottom">
                                    <field name="sequence" widget="handle"/>
                                    <field name="name"/>
                                    <field name="user_id" widget="many2one_avatar_user"/>
                                    <field name="date_deadline"/>
                                    <field name="state"/>
                                    <field name="hours_planned" widget="float_time" sum="Total"/>
                                    <field name="hours_spent" widget="float_time" sum="Total"/>
                                    <field name="progress" widget="progressbar"/>
                                </list>

                                <!-- Inline form view -->
                                <form string="Task">
                                    <sheet>
                                        <group>
                                            <group>
                                                <field name="name"/>
                                                <field name="user_id"/>
                                                <field name="state"/>
                                            </group>
                                            <group>
                                                <field name="date_deadline"/>
                                                <field name="hours_planned" widget="float_time"/>
                                                <field name="hours_spent" widget="float_time"/>
                                                <field name="progress"/>
                                            </group>
                                        </group>
                                        <group>
                                            <field name="description" placeholder="Task description..."/>
                                        </group>
                                    </sheet>
                                </form>
                            </field>
                        </page>

                        <!-- Tab 4: Team -->
                        <page string="Team" name="team">
                            <field name="team_member_ids" widget="many2many">
                                <kanban>
                                    <field name="id"/>
                                    <field name="name"/>
                                    <field name="email"/>
                                    <templates>
                                        <t t-name="kanban-box">
                                            <div class="oe_kanban_global_click">
                                                <div class="o_kanban_image">
                                                    <img alt="Avatar" t-att-src="kanban_image('res.users', 'avatar_128', record.id.raw_value)"/>
                                                </div>
                                                <div class="oe_kanban_details">
                                                    <strong class="o_kanban_record_title">
                                                        <field name="name"/>
                                                    </strong>
                                                    <div class="o_kanban_record_subtitle">
                                                        <field name="email"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </t>
                                    </templates>
                                </kanban>
                            </field>
                        </page>

                        <!-- Tab 5: Attachments -->
                        <page string="Attachments" name="attachments">
                            <field name="attachment" widget="binary" filename="attachment_name"/>
                            <field name="attachment_name" invisible="1"/>
                        </page>

                        <!-- Tab 6: Internal Notes (restricted access) -->
                        <page string="Internal Notes" name="notes" groups="base.group_user">
                            <field name="internal_notes" placeholder="Internal notes not visible to customers..."/>
                        </page>

                        <!-- Tab 7: Settings (conditional visibility) -->
                        <page string="Settings" name="settings" invisible="state == 'draft'">
                            <group>
                                <group string="Template">
                                    <field name="template_id"
                                           invisible="not is_template"
                                           domain="[('is_template', '=', True), ('id', '!=', id)]"/>
                                </group>
                                <group string="Advanced">
                                    <field name="sequence"/>
                                    <field name="reference"/>
                                    <field name="last_update_date" readonly="1"/>
                                    <field name="date_approved" readonly="1"/>
                                </group>
                            </group>
                        </page>
                    </notebook>

                </sheet>

                <!-- ========================================= -->
                <!-- CHATTER: Messages, Activities, Followers -->
                <!-- ========================================= -->

                <chatter/>

            </form>
        </field>
    </record>

    <!-- ========================================= -->
    <!-- FORM VIEW WITH INVISIBLE FIELDS EXAMPLE -->
    <!-- ========================================= -->

    <record id="view_project_form_conditional" model="ir.ui.view">
        <field name="name">project.project.form.conditional</field>
        <field name="model">project.project</field>
        <field name="priority">20</field>
        <field name="arch" type="xml">
            <form string="Project">
                <sheet>
                    <group>
                        <!-- Odoo 18: Use Python expressions for invisible/readonly/required -->

                        <!-- Simple condition -->
                        <field name="name"/>
                        <field name="state"/>
                        <field name="code" readonly="state != 'draft'"/>

                        <!-- Multiple conditions with boolean operators -->
                        <field name="partner_id"
                               required="state in ('approved', 'in_progress')"
                               readonly="state in ('done', 'cancelled')"/>

                        <!-- Complex conditions -->
                        <field name="budget"
                               invisible="not is_billable or state == 'draft'"
                               readonly="state in ('done', 'cancelled')"/>

                        <!-- Field visibility based on other field -->
                        <field name="is_billable"/>
                        <field name="amount_invoiced"
                               invisible="not is_billable"/>

                        <!-- Field visibility based on computed field -->
                        <field name="is_overdue" invisible="1"/>
                        <field name="date_deadline"
                               decoration-danger="is_overdue"/>

                        <!-- Required based on condition -->
                        <field name="user_id"
                               required="state not in ('draft', 'cancelled')"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- ========================================= -->
    <!-- FORM VIEW WITH ALL WIDGET EXAMPLES -->
    <!-- ========================================= -->

    <record id="view_project_form_widgets" model="ir.ui.view">
        <field name="name">project.project.form.widgets</field>
        <field name="model">project.project</field>
        <field name="priority">30</field>
        <field name="arch" type="xml">
            <form string="Widget Examples">
                <sheet>
                    <notebook>
                        <page string="Text Widgets" name="text_widgets">
                            <group>
                                <field name="name" widget="char"/>
                                <field name="email" widget="email"/>
                                <field name="phone" widget="phone"/>
                                <field name="website" widget="url"/>
                                <field name="description" widget="text"/>
                                <field name="specification" widget="html"/>
                            </group>
                        </page>

                        <page string="Numeric Widgets" name="numeric_widgets">
                            <group>
                                <field name="sequence" widget="integer"/>
                                <field name="budget" widget="monetary"/>
                                <field name="progress" widget="percentage"/>
                                <field name="progress" widget="progressbar"/>
                                <field name="hours_spent" widget="float_time"/>
                            </group>
                        </page>

                        <page string="Date Widgets" name="date_widgets">
                            <group>
                                <field name="date_start" widget="date"/>
                                <field name="date_approved" widget="datetime"/>
                                <field name="date_deadline" widget="date" options="{'datepicker': {'daysOfWeekDisabled': [0, 6]}}"/>
                                <field name="date_range" widget="daterange"/>
                            </group>
                        </page>

                        <page string="Selection Widgets" name="selection_widgets">
                            <group>
                                <field name="state" widget="statusbar"/>
                                <field name="state" widget="selection"/>
                                <field name="state" widget="radio"/>
                                <field name="priority" widget="priority"/>
                                <field name="priority" widget="selection_badge"/>
                                <field name="active" widget="boolean"/>
                                <field name="active" widget="toggle_button"/>
                            </group>
                        </page>

                        <page string="Relational Widgets" name="relational_widgets">
                            <group>
                                <field name="partner_id" widget="many2one"/>
                                <field name="user_id" widget="many2one_avatar_user"/>
                                <field name="user_id" widget="many2one_avatar"/>
                                <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color'}"/>
                                <field name="tag_ids" widget="many2many_checkboxes"/>
                                <field name="team_member_ids" widget="many2many_avatar_user"/>
                            </group>
                        </page>

                        <page string="Binary Widgets" name="binary_widgets">
                            <group>
                                <field name="attachment" widget="binary"/>
                                <field name="image_1920" widget="image"/>
                                <field name="signature" widget="signature"/>
                            </group>
                        </page>

                        <page string="Special Widgets" name="special_widgets">
                            <group>
                                <field name="color" widget="color"/>
                                <field name="kanban_state" widget="state_selection"/>
                                <field name="activity_ids" widget="mail_activity"/>
                                <field name="message_follower_ids" widget="mail_followers"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

</odoo>
